containers:
  default:
    docker: "circleci/ruby:2.5.1"

steps:
# This prepares bundler and yarn for the other tasks, since they depend on it.
- label: 'Prepare dependencies'
  run:
    - "gem install bundler --version=1.17.3"
    - shopify-build pause
    # By specifying bundler and yarn as inline commands, Shopify Build will
    # run `bundle install` and `yarn install`, and cache the results between
    # builds for better performance.
    - bundle: ~
  timeout: 5m
# We want the other tasks to have the bundler/yarn caches available, so we
# explicitly wait here.
- wait
- label: ":ruby: Specs"
  dependencies:
  - "bundler"
  timeout: "5m"
  run:
  - "bin/test"
- label: "Rubocop"
  dependencies:
  - "bundler"
  timeout: "5m"
  run: "bin/style"
